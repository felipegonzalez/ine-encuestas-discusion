<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.466">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="F González">

<title>Encuesta de módulos: exploración</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script src="encuesta-modulos_files/libs/clipboard/clipboard.min.js"></script><script src="encuesta-modulos_files/libs/quarto-html/quarto.js"></script><script src="encuesta-modulos_files/libs/quarto-html/popper.min.js"></script><script src="encuesta-modulos_files/libs/quarto-html/tippy.umd.min.js"></script><script src="encuesta-modulos_files/libs/quarto-html/anchor.min.js"></script><link href="encuesta-modulos_files/libs/quarto-html/tippy.css" rel="stylesheet"><link href="encuesta-modulos_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><script src="encuesta-modulos_files/libs/bootstrap/bootstrap.min.js"></script><link href="encuesta-modulos_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet"><link href="encuesta-modulos_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet"></head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Encuesta de módulos: exploración</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor</div>
    <div class="quarto-title-meta-contents">
             <p>F González </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<p>Lectura de datos: encuestas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># datos encuestas</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>encuesta_tbl <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"datos/modulos/1_Ponderadores/Resultados8_encuesta_registros_ponderadores.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">registrado_sistema =</span> <span class="sc">!</span><span class="fu">is.na</span>(Ponderador_sol_cred)) <span class="do">## variable correcta?</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># turnos censados</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>turnos_tbl <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"datos/modulos/1_Ponderadores/Datos_Modulos19_Muestra.csv"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Leer datos cecyrd:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quitar modulos 60, 61 y 91</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>datos_cecyrd <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"datos/modulos/1_Ponderadores/Datos_SOLICITUDES_ENTREGAS_CPV_281019_AL_101119.txt"</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">delim =</span> <span class="st">"|"</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">escape_double =</span> <span class="cn">FALSE</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">FECHA_CREACION_MAC =</span> <span class="fu">col_datetime</span>(<span class="at">format =</span> <span class="st">"%d/%m/%Y %H:%M:%S"</span>), </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">FECHA_ENTREGA_CREDENCIAL =</span> <span class="fu">col_datetime</span>(<span class="at">format =</span> <span class="st">"%d/%m/%Y %H:%M:%S"</span>), </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUAR =</span> <span class="fu">col_character</span>(), <span class="at">MODULO_IFE_ID =</span> <span class="fu">col_character</span>()),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">trim_ws =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Edo =</span> <span class="fu">str_sub</span>(MODULO_IFE_ID, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Dtto =</span> <span class="fu">str_sub</span>(MODULO_IFE_ID, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_adicional =</span> <span class="fu">str_sub</span>(MODULO_IFE_ID, <span class="dv">5</span>, <span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id_adicional <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"51"</span>, <span class="st">"52"</span>, <span class="st">"53"</span>, <span class="st">"54"</span>, <span class="st">"55"</span>, <span class="st">"56"</span>, <span class="st">"57"</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Construir marco de cecyrd</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>modulos_marco_cec <span class="ot">&lt;-</span> datos_cecyrd <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(MODULO_IFE_ID, Edo, Dtto) <span class="sc">|&gt;</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_registro =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>modulos_distrito <span class="ot">&lt;-</span> modulos_marco_cec <span class="sc">|&gt;</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Edo, Dtto) <span class="sc">|&gt;</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_modulos =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="replicar-resultados-no-ponderados" class="level2">
<h2 class="anchored" data-anchor-id="replicar-resultados-no-ponderados">Replicar resultados no ponderados</h2>
<p>Motivo de visita, sin ponderar (replicar Gráfica 4 y Gráfica 5)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafica 4</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>tabla_4 <span class="ot">&lt;-</span> encuesta_tbl <span class="sc">|&gt;</span>  </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(m_cuest2) <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n), <span class="dv">2</span>)) </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>tabla_4</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  m_cuest2     n     p
     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
1        1   806  6.55
2        2  4915 40.0 
3        3  5123 41.7 
4        4  1452 11.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfica 5</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>tabla_5 <span class="ot">&lt;-</span> encuesta_tbl <span class="sc">|&gt;</span> <span class="fu">group_by</span>(tipo_modulo) <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(m_cuest2) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n), <span class="dv">1</span>)) </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>tabla_5</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
# Groups:   tipo_modulo [2]
  tipo_modulo m_cuest2     n     p
  &lt;chr&gt;          &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
1 FIJO               1   646   5.8
2 FIJO               2  4464  39.9
3 FIJO               3  4748  42.4
4 FIJO               4  1336  11.9
5 ITINERANTE         1   160  14.5
6 ITINERANTE         2   451  40.9
7 ITINERANTE         3   375  34  
8 ITINERANTE         4   116  10.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>g5_no_pond <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tabla_5, <span class="fu">aes</span>(<span class="at">x =</span> tipo_modulo, <span class="at">y =</span> p, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="fu">factor</span>(m_cuest2), <span class="at">label =</span> p)) <span class="sc">+</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>g5_no_pond</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="encuesta-modulos_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="resultados-con-diseño-primera-aproximación" class="level2">
<h2 class="anchored" data-anchor-id="resultados-con-diseño-primera-aproximación">Resultados con diseño (primera aproximación)</h2>
<p>Utilizando el diseño planteado en la sección de metodología, consideramos la expansión que tal diseño sugiere, donde los factores de expansión a nivel unidad primaria son dados por el número de distritos, el número de módulos dentro de cada distrito, y le número de días para el que se pretende hacerla expansión.</p>
<p>Las unidades secundarias son días-módulo, y buscamos hacer expansión a Lunes-Viernes del 28 de octubre al 8 de noviembre (10 días).</p>
<p>Sin embargo, hacemos las siguientes observaciones, en cuanto a la no realización del <strong>censo dentro de cada módulo</strong> seleccionado. Ambas observaciones apuntan hacia simplificar el trabajo administrativo y acercar más el diseño a uno probabilístico:</p>
<ol type="1">
<li><strong>No respuesta por carga de trabajo</strong>. Puede considerarse algún tipo de muestreo sistemático dentro de los módulos, pues según los registros, no se alcanza a capturar todos los visitantes, incluso sólo considerando aquellos que corresponden a solicitudes y entregas de credenciales. Muestrear a este nivel de una manera simple, cercana a aleatoria, puede aliviar simplificar la operación, y obtener resultados más cercanos a selección probabilística.</li>
</ol>
<p>Acerca de los días de visita y turnos:</p>
<ol start="2" type="1">
<li><strong>Selección no aleatoria de días y falta de información de segundos turnos</strong>. Los días de visita para cada módulo podrían seleccionarse aleatoriamente. Si existe más de un turno puede recopilarse información de ambos turnos o seleccionar uno al azar.</li>
</ol>
<p>Finalmente, acerca de los módulos itinerantes:</p>
<ol start="3" type="1">
<li><strong>Mecanismo de selección de itinerantes</strong>. Es posible hacer estimaciones separadas por módulos fijos e intinerantes bajo el diseño actual. Sin embargo, calcular varianzas para los agregados no es directo a menos que se conozca el procedimiento exacto para su selección, y cómo depende del módulo fijo seleccionado.</li>
</ol>
<ul>
<li>Si es apropiado, esto se puede mejorar agrupando en un principio módulos que son seleccionados juntos, y considerándolos como una unidad completa.</li>
<li>En otro caso, tenemos que conocer la probabilidad condicional de seleccionar cada módulo itinerante dado que seleccionó cada uno de los módulos fijos.</li>
</ul>
<p>Para el siguiente ejercicio, utilizaremos:</p>
<ol type="1">
<li><p>Estratificación: es necesario usar la estratificación CMDX-NoCDMX.</p></li>
<li><p>Consideramos las UPMs como distritos,</p></li>
<li><p>El ponderador es el número de días de trabajo para los módulos de la CDMX y es <span class="math inline">\((276/26)*(N_i/n_i)*d_i\)</span> donde <span class="math inline">\(N_i\)</span> es el número de módulos en cada distrito, <span class="math inline">\(n_i\)</span> el número de módulos seleccionados en muestra para el distrito, y <span class="math inline">\(d_i\)</span> es el número de días que el módulo estuvo operando.</p></li>
<li><p>Sólo se visita un turno (el primero). Estrictamente, <strong>sólo podemos hacer estimaciones para los primeros turnos de la población de módulos</strong>. Más adelante proponemos una corrección parcial de esto, pero sería mejor visitar los dos turnos o seleccionar en la muestra distintos turnos al azar.</p></li>
<li><p>Ignoramos la no respuesta: en algunos módulos no fueron capturados todos los visitantes (de manera no controlada).</p></li>
<li><p>Tomamos como seleccionados al azar de manera independiente los módulos itinerantes. Esto no es correcto por la construcción del diseño, y puede afectar las varianzas estimadas.</p></li>
<li><p>Sin embargo, el análisis puede llevarse a cabo sólo con los módulos fijos, y en ese caso el supuesto solo es el (4), de no respuesta ignorable.</p></li>
</ol>
<p>Cálculo de probabilidad de selección:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>num_modulos_tbl <span class="ot">&lt;-</span> <span class="fu">group_by</span>(encuesta_tbl, Edo, Dtto) <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_selec =</span> <span class="fu">n_distinct</span>(modulo)) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>encuesta_pesos_tbl <span class="ot">&lt;-</span> encuesta_tbl <span class="sc">|&gt;</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(num_modulos_tbl) <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dias_trabajados =</span> dias_trabajados_sem1 <span class="sc">+</span> dias_trabajados_sem2) <span class="sc">|&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Origen) <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dias_trabajados_estrato =</span> <span class="fu">sum</span>(dias_trabajados)) <span class="sc">|&gt;</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(modulos_distrito) <span class="sc">|&gt;</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(turnos_tbl <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="at">modulo =</span> MODULO_IFE_ID, <span class="at">turnos =</span> TURNOS) <span class="sc">|&gt;</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">modulo =</span> <span class="fu">str_pad</span>(modulo, <span class="dv">6</span>, <span class="at">pad =</span> <span class="st">"0"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">turnos =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(turnos), <span class="dv">2</span>, turnos)) <span class="sc">|&gt;</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#selección de distrito y módulos</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">ifelse</span>(Edo <span class="sc">!=</span> <span class="st">"09"</span>, (n_selec<span class="sc">/</span>n_modulos)<span class="sc">*</span>(<span class="dv">26</span><span class="sc">/</span><span class="dv">276</span>), <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#selección de día de trabajo</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> p <span class="sc">/</span> (dias_trabajados)) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Definición de diseño:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dis_modulos <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span>Dtto, <span class="at">strata =</span> <span class="sc">~</span>Origen, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="sc">~</span> p, <span class="at">data =</span> encuesta_pesos_tbl, <span class="at">nest =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Análisis ponderado y no ponderado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>tabla_5_dis <span class="ot">&lt;-</span> dis_modulos <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tipo_modulo, m_cuest2) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cat_1 =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">survey_prop</span>(<span class="at">vartype =</span> <span class="st">"ci"</span>), <span class="dv">2</span>)) </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>tabla_5_dis</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
# Groups:   tipo_modulo [2]
  tipo_modulo m_cuest2 cat_1 cat_1_low cat_1_upp
  &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 FIJO               1  7.62      3.66      11.6
2 FIJO               2 41.1      39.0       43.3
3 FIJO               3 38.4      34         42.8
4 FIJO               4 12.8      10.4       15.4
5 ITINERANTE         1 10.9       5.53      16.3
6 ITINERANTE         2 44.0      33.5       54.5
7 ITINERANTE         3 36.4      28.5       44.4
8 ITINERANTE         4  8.67      5.72      11.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>g5_pond_1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tabla_5_dis, <span class="fu">aes</span>(<span class="at">x =</span> tipo_modulo, <span class="at">y =</span> cat_1, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="fu">factor</span>(m_cuest2), <span class="at">label =</span> cat_1)) <span class="sc">+</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Ponderado 1"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>g5_no_pond <span class="ot">&lt;-</span> g5_no_pond <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"No ponderado"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>g5_no_pond <span class="sc">+</span> g5_pond_1 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">'collect'</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="encuesta-modulos_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Especialmente para itinerantes, el error estimado es grande. Las estimaciones no son iguales ponderando de esta manera que sin ponderar. Una nota importante es que es importante separar el estrato de CDMX en estos datos, pues en otro caso resultan sobrerrepresentados.</p>
<ul>
<li><em>Nota</em>: incluye expansión a dos turnos a partir del primero solamente. Esto no está bien justificado, y pueden muestrearse segundos turnos también, o restringir la inferencia a primer turno.</li>
</ul>
</section>
<section id="estimación-de-otras-cantidades-y-no-respuesta" class="level2">
<h2 class="anchored" data-anchor-id="estimación-de-otras-cantidades-y-no-respuesta">Estimación de otras cantidades y no respuesta</h2>
<p>Para estimar totales, podemos ajustar por la no respuesta del censo. Si hacemos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dis_modulos <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(registrado_sistema) <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_tally</span>(<span class="at">vartype =</span> <span class="st">"ci"</span>) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  registrado_sistema       n   n_low    n_upp
  &lt;lgl&gt;                &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 FALSE              243940. 127778.  360102.
2 TRUE               957827. 511171. 1404483.</code></pre>
</div>
</div>
<p>En primer lugar, estimación puede ser baja, por la siguiente razón, por no respuesta y porque estamos ignorando el segundo turno.</p>
<p>Consideramos todas las solicitudes y entregas registradas en cecyrd,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>datos_cecyrd_creacion <span class="ot">&lt;-</span> datos_cecyrd <span class="sc">|&gt;</span> <span class="fu">select</span>(FUAR, MODULO_IFE_ID, <span class="at">fecha =</span> FECHA_CREACION_MAC) </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>datos_cecyrd_entrega <span class="ot">&lt;-</span> datos_cecyrd <span class="sc">|&gt;</span> <span class="fu">select</span>(FUAR, MODULO_IFE_ID, <span class="at">fecha =</span> FECHA_ENTREGA_CREDENCIAL)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>datos_fecha_cec <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(datos_cecyrd_creacion, datos_cecyrd_entrega) <span class="sc">|&gt;</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fecha =</span> <span class="fu">as.Date</span>(fecha)) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="at">modulo =</span> MODULO_IFE_ID, <span class="at">fecha =</span> fecha)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>datos_encuesta_cec <span class="ot">&lt;-</span> <span class="fu">semi_join</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  datos_fecha_cec <span class="sc">|&gt;</span> <span class="fu">ungroup</span>(), </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  encuesta_pesos_tbl <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(modulo, <span class="at">fecha =</span> Dia_Trabajado) <span class="sc">|&gt;</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(fecha))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = c("modulo", "fecha")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>datos_resumen_cec <span class="ot">&lt;-</span> datos_encuesta_cec <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(modulo, fecha) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_registros =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>encuesta_modulos_tbl <span class="ot">&lt;-</span> encuesta_pesos_tbl <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Origen, Edo, Dtto, modulo, tipo_modulo, Dia_Trabajado, registrado_sistema) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fecha =</span> <span class="fu">ymd</span>(Dia_Trabajado)) <span class="sc">|&gt;</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Dia_Trabajado)) <span class="sc">|&gt;</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(registrado_sistema) </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>comparacion_tbl <span class="ot">&lt;-</span> <span class="fu">left_join</span>(encuesta_modulos_tbl, datos_resumen_cec) <span class="sc">|&gt;</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dia_sem =</span> <span class="fu">weekdays</span>(fecha)) <span class="sc">|&gt;</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">factor =</span> n_registros <span class="sc">/</span> n)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = c("modulo", "fecha")</code></pre>
</div>
</div>
<p>La siguiente gráfica muestra que no se capturan en la encuesta todas las entradas del cecyrd</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparacion_tbl, <span class="fu">aes</span>(<span class="at">x =</span> n_registros, <span class="at">y =</span> n)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> x) <span class="sc">+</span> <span class="fu">geom_abline</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> Origen)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="encuesta-modulos_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(n <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Origen<span class="sc">:</span>n_registros, comparacion_tbl)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = n ~ -1 + Origen:n_registros, data = comparacion_tbl)

Coefficients:
     OrigenCDMX:n_registros  OrigenProvincia:n_registros  
                     0.6040                       0.7509  </code></pre>
</div>
</div>
<p>Agregamos el factor correspondiente para este subregistro:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>encuesta_pesos_tbl <span class="ot">&lt;-</span> encuesta_pesos_tbl <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(comparacion_tbl <span class="sc">|&gt;</span> <span class="fu">select</span>(modulo, factor)) <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_factor =</span> p <span class="sc">/</span> factor)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = "modulo"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dis_modulos_2 <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span>Dtto, <span class="at">strata =</span> <span class="sc">~</span>Origen, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="sc">~</span> p_factor, <span class="at">data =</span> encuesta_pesos_tbl, <span class="at">nest =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bajo los supuestos mostrados arriba, intentaremos estimaciones del total de personas que acudieron a los módulos en la semana de interés, por tipo de módulo. Con el factor adicional por selección de personas, obtenemos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dis_modulos_2 <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_tally</span>(<span class="at">vartype =</span> <span class="st">"ci"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
         n   n_low    n_upp
     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 1509152. 811163. 2207141.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dis_modulos_2 <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(registrado_sistema) <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_tally</span>(<span class="at">vartype =</span> <span class="st">"ci"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  registrado_sistema        n   n_low    n_upp
  &lt;lgl&gt;                 &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 FALSE               298903. 158042.  439764.
2 TRUE               1210249. 638976. 1781522.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>dis_modulos_2 <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tipo_modulo) <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">survey_tally</span>(<span class="at">vartype =</span> <span class="st">"ci"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  tipo_modulo        n   n_low    n_upp
  &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 FIJO        1255164. 610123. 1900205.
2 ITINERANTE   253988. 134120.  373856.</code></pre>
</div>
</div>
<p><strong>Nota</strong>: Estas estimaciones tienen alto grado de incertidumbre. Veremos más adelante cómo utilizar la información auxiliar de cecyrd para construir un mejor estimador de razón.</p>
<div class="cell">
<details>
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#encuesta_pesos_tbl |&gt; </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  group_by(Origen) |&gt; </span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  summarise(n = n(), n_pond = sum(!is.na(Ponderador_sol_cred))) |&gt; </span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate(factor = n / n_pond)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>La tabla mostrada arriba, con intervalos de confianza, ahora resulta en:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>tabla_5_dis <span class="ot">&lt;-</span> dis_modulos_2 <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tipo_modulo, m_cuest2) <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cat_1 =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">survey_prop</span>(<span class="at">vartype =</span> <span class="st">"ci"</span>), <span class="dv">2</span>)) </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>tabla_5_dis</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
# Groups:   tipo_modulo [2]
  tipo_modulo m_cuest2 cat_1 cat_1_low cat_1_upp
  &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 FIJO               1  7.36      3.85      10.9
2 FIJO               2 41.4      39.1       43.7
3 FIJO               3 38.6      34.9       42.4
4 FIJO               4 12.6      10.3       14.8
5 ITINERANTE         1 10.6       5.26      16.0
6 ITINERANTE         2 44.5      33.7       55.3
7 ITINERANTE         3 36.3      28.1       44.5
8 ITINERANTE         4  8.58      5.62      11.5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>g5_pond_2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tabla_5_dis, <span class="fu">aes</span>(<span class="at">x =</span> tipo_modulo, <span class="at">y =</span> cat_1, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="fu">factor</span>(m_cuest2), <span class="at">label =</span> cat_1)) <span class="sc">+</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Ponderado 2"</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>g5_no_pond <span class="sc">+</span> g5_pond_1 <span class="sc">+</span> g5_pond_2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">'collect'</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="encuesta-modulos_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Los dos análisis ponderados dan resultados similares, considerablemente distintos del análisis no ponderado.</p>
</section>
<section id="estimador-de-razón-con-variables-auxiliares" class="level2">
<h2 class="anchored" data-anchor-id="estimador-de-razón-con-variables-auxiliares">Estimador de razón con variables auxiliares</h2>
<p>Otro enfoque puede ser utilizar un estimador de razón para incrementar la precisión:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>total_trans <span class="ot">&lt;-</span> datos_cecyrd <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Origen =</span> <span class="fu">ifelse</span>(Edo <span class="sc">==</span> <span class="st">"09"</span>, <span class="st">"CDMX"</span>, <span class="st">"Provincia"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Origen) <span class="sc">|&gt;</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>encuesta_mod_tbl <span class="ot">&lt;-</span> encuesta_pesos_tbl <span class="sc">|&gt;</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Origen, Dtto, modulo, n_modulos, dias_trabajados) <span class="sc">|&gt;</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">num_reg =</span> <span class="fu">sum</span>(registrado_sistema), </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">num_no_reg =</span> <span class="fu">sum</span>(<span class="sc">!</span>registrado_sistema)) <span class="sc">|&gt;</span> </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Origen, Dtto) <span class="sc">|&gt;</span> </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_selec =</span> <span class="fu">n_distinct</span>(modulo)) <span class="sc">|&gt;</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(modulos_distrito) <span class="sc">|&gt;</span> </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(turnos_tbl <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="at">modulo =</span> MODULO_IFE_ID, <span class="at">turnos =</span> TURNOS) <span class="sc">|&gt;</span> </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">modulo =</span> <span class="fu">str_pad</span>(modulo, <span class="dv">6</span>, <span class="at">pad =</span> <span class="st">"0"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">turnos =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(turnos), <span class="dv">2</span>, turnos)) <span class="sc">|&gt;</span> </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">ifelse</span>(Origen <span class="sc">==</span> <span class="st">"CDMX"</span>, <span class="dv">1</span>, (<span class="dv">26</span><span class="sc">/</span><span class="dv">276</span>) <span class="sc">*</span> (n_selec <span class="sc">/</span> n_modulos))) <span class="sc">|&gt;</span> </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> p  <span class="sc">/</span> dias_trabajados) <span class="sc">|&gt;</span> </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(total_trans <span class="sc">|&gt;</span> <span class="fu">select</span>(Origen, <span class="at">n_cec =</span> n)) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Origen', 'Dtto', 'modulo', 'n_modulos'.
You can override using the `.groups` argument.
Joining, by = c("Dtto", "n_modulos")
Joining, by = "modulo"
Joining, by = "Origen"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dis_upm_1 <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span>Dtto, <span class="at">strata =</span> <span class="sc">~</span> Origen, <span class="at">probs =</span> <span class="sc">~</span> p, </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> encuesta_mod_tbl,  <span class="at">nest =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>res_factor <span class="ot">&lt;-</span> dis_upm_1 <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">est_razon =</span> <span class="fu">survey_ratio</span>( num_no_reg, num_reg)) <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">sum</span>(total_trans<span class="sc">$</span>n)) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_est =</span> n <span class="sc">*</span> est_razon, <span class="at">n_est_se =</span> n <span class="sc">*</span> est_razon_se) <span class="sc">|&gt;</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">no_reg =</span> n_est, <span class="at">no_reg_ee =</span> n_est_se)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>res_factor</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  est_razon est_razon_se      n  no_reg no_reg_ee
      &lt;dbl&gt;        &lt;dbl&gt;  &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1     0.253       0.0277 908366 229830.    25198.</code></pre>
</div>
</div>
<p><strong>Nota</strong>: el error es considerablemente menor que el estimador anterior.</p>
<p>Cortado por CDMX y noCDMX se ve como sigue:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>res_factor <span class="ot">&lt;-</span> dis_upm_1 <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Origen) <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">est_razon =</span> <span class="fu">survey_ratio</span>(num_no_reg, num_reg )) <span class="sc">|&gt;</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(total_trans) <span class="sc">|&gt;</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_est =</span> n <span class="sc">*</span> est_razon, <span class="at">n_est_se =</span> n <span class="sc">*</span> est_razon_se) <span class="sc">|&gt;</span> </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">no_reg =</span> n_est, <span class="at">no_reg_ee =</span> n_est_se)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = "Origen"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>res_factor</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  Origen    est_razon est_razon_se      n  no_reg no_reg_ee
  &lt;chr&gt;         &lt;dbl&gt;        &lt;dbl&gt;  &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1 CDMX          0.199       0.0147  78450  15648.     1155.
2 Provincia     0.258       0.0300 829916 213777.    24875.</code></pre>
</div>
</div>
<p>Este estimador aprovecha la relación entre número de registrados y no registrados que se capturó en la encuesta:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(encuesta_mod_tbl, <span class="fu">aes</span>(<span class="at">x =</span> num_reg, <span class="at">y =</span> num_no_reg)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> x) <span class="sc">+</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Número de visitantes, por estatus de registro en cecyrd"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="encuesta-modulos_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>